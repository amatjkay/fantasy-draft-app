# Critical Bugs Fixed - 2025-10-21

## Session 1: Draft Implementation Bugs

### Bug 1: "Unknown Player" в списке пиков ✅ FIXED
**Проблема:** API /team возвращал только playerIds, а не полные объекты
**Решение:** Изменён data.ts - теперь возвращает полные player objects в поле `team.picks`

### Bug 2: $NaNM в отображении cap
**Проблема:** UI пытается посчитать cap от undefined player
**Решение:** Добавлена защита с optional chaining: `p?.capHit ?? 0`

### Bug 3: Кнопки заблокированы во втором раунде
**Проблема:** draft:state не обновляет activeUserId правильно
**Требуется:** Проверить что Socket.IO отправляет полное состояние после каждого пика

### Bug 4: Нет кнопки "Вернуться в драфт"
**Проблема:** При выходе из драфта нельзя вернуться
**Требуется:** Добавить проверку активного драфта и кнопку возврата

---

## Критические исправления backend:

1. ✅ Singleton draftManager (REST + Socket.IO используют один экземпляр)
2. ✅ Команды для ботов создаются при addBots
3. ✅ makeAutoPick получает userId как первый параметр
4. ✅ API /team возвращает полные player objects

## Критические исправления frontend:

1. ✅ Защита от undefined в player stats (optional chaining)
2. ⏳ Нужно: Проверка и исправление определения "мой ход"
3. ⏳ Нужно: Кнопка "Вернуться в драфт"

---

## Следующие шаги:

1. Перезапустить сервер с новыми исправлениями
2. Проверить что team.picks содержит полные объекты
3. Проверить что cap отображается правильно
4. Проверить что кнопки разблокируются в свой ход
5. Добавить UI для возврата в драфт
